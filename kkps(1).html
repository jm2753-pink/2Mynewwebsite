<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Interactive</title>

	<link rel="stylesheet" type="text/css" href="style-p4(1).css">

	<style> @import url('https://fonts.cdnfonts.com/css/vipnagorgialla'); </style>
	
	<style>
		.phone-container {
			position: relative;
			display: inline-block;
			cursor: pointer;
			margin-left: 400px;
		}
		
        .wade-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 150px; /* Adjust size as needed */
            cursor: pointer;
            z-index: 1000;
        }

        .wade-container img {
            width: 100%;
            height: auto;
            transform: rotate(90deg);
            transition: transform 0.2s ease;
        }

        .wade-container:hover img {
            transform: rotate(90deg) scale(1.1);
        }

		.phone-container img {
			position: absolute;
			top: 0;
			left: 0;
			transition: opacity 0.3s ease;
			display: block;
			max-width: 50%;
			height: auto;
		}
		
		#image1 {
			z-index: 1;
			opacity: 0;
			position: relative;
		}
		
		#image2 {
			z-index: 2;
			opacity: 1;
			position: absolute;
			top: 0;
			left: 0;
		}
		
		.phone-container:hover #image1 {
			opacity: 1;
		}
		
		.phone-container:hover #image2 {
			opacity: 0;
		}
		
		.phone-button {
			position: absolute;
			cursor: pointer;
			z-index: 10;
			background: transparent;
			border: none;
			opacity: 0;
			pointer-events: none;
		}
		
		.phone-container:hover .phone-button {
			opacity: 1;
			pointer-events: auto;
		}
		
		.phone-button:hover {
			background: rgba(255, 255, 255, 0.1);
		}
		
		.phone-screen-video {
			position: absolute;
			z-index: 5;
			opacity: 0;
			pointer-events: none;
			top: 25%;
			left: -3%;
			width: 56%;
			height: 20%;
			object-fit: contain;
			transition: opacity 0.3s ease;
		}
		
		.phone-container:hover .phone-screen-video {
			opacity: 1;
			pointer-events: auto;
		}
	</style>

</head>
<body>

<h1 style="text-align: center; color: hotpink; margin-top: 20px; font-size: 3em;">What's the sitch?</h1>

<div class="menu">
	<a href="KIP.html">Kim Possible</a>
	<a href="KPW(1).html">Interactive</a>
	<a href="index.html">Vipnagorgialla</a>
	<a href="kpossibp2(1).html">About</a>
    <a href="KPW(1).html">Letters</a>
</div>

<div class="wade-container" onclick="playTroubleAudio()">
    <img src="images/wade.png" alt="Wade">
</div>

<audio id="troubleAudio" src="audio/trouble.m4a" preload="auto"></audio>

<div class="phone-container">
	<img id="image1" src="images/flipphone.png" alt="Flip Phone">
	<img id="image2" src="images/flipphonclose1.1.png" alt="Flip Phone Close">
	<!-- Video on the phone screen (only visible when fliphone.png is shown) -->
	<video class="phone-screen-video" src="video/CodingVrecording.mov" autoplay loop muted playsinline></video>
	<!-- Clickable buttons on the keypad (only visible when fliphone.png is shown) -->
	<button class="phone-button" style="top: 60%; left: 20%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 60%; left: 35%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 60%; left: 50%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 68%; left: 20%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 68%; left: 35%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 68%; left: 50%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 76%; left: 20%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 76%; left: 35%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
	<button class="phone-button" style="top: 76%; left: 50%; width: 8%; height: 6%;" onclick="playPhoneAudio()"></button>
</div>

<audio id="phoneAudio" src="audio/KPAudio.m4a" preload="auto"></audio>





<div class="number-container">
  <div class="number">1</div>
  <div class="number">2</div>
  <div class="number">3</div>
  <div class="number">4</div>
  <div class="number">5</div>
  <div class="number">6</div>
  <div class="number">7</div>
  <div class="number">8</div>
  <div class="number">9</div>
  <div class="number">@</div>
  <div class="number">#</div>
  <div class="number">!</div>
  <div class="number">&</div>
  <div class="number">%</div>
</div>

<script>
    // Shared AudioContext for all audio to manage policies better
    let audioContext;
    
    // Track if context is unlocked
    let isAudioUnlocked = false;

    // Initialize/Unlock Audio Context on first user interaction
    function unlockAudio() {
        if (isAudioUnlocked) return;
        
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (!audioContext) {
            audioContext = new AudioContext();
        }
        
        if (audioContext.state === 'suspended') {
            audioContext.resume().then(() => {
                isAudioUnlocked = true;
                console.log("AudioContext resumed");
            });
        } else {
            isAudioUnlocked = true;
        }
        
        // Remove listeners once unlocked
        ['click', 'touchstart', 'keydown'].forEach(event => {
            document.removeEventListener(event, unlockAudio);
        });
    }

    // Add unlock listeners to document
    ['click', 'touchstart', 'keydown'].forEach(event => {
        document.addEventListener(event, unlockAudio);
    });

    // Helper to play audio with gain
    function playAudioWithGain(audioId, gainValue, resetTime = false) {
        unlockAudio(); // Ensure unlocked
        
        const audio = document.getElementById(audioId);
        if (!audio) return;

        // Create context if not exists (should be created by unlock, but safety check)
        if (!audioContext) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioContext = new AudioContext();
        }

        // If source node doesn't exist for this element, create it
        // We attach it to the element to persist it
        if (!audio._sourceNode) {
            audio._sourceNode = audioContext.createMediaElementSource(audio);
            audio._gainNode = audioContext.createGain();
            audio._sourceNode.connect(audio._gainNode);
            audio._gainNode.connect(audioContext.destination);
        }

        // Update gain
        if (audio._gainNode) {
            audio._gainNode.gain.value = gainValue;
        }

        if (audio.paused) {
            if (resetTime) {
                audio.currentTime = 0;
            }
            audio.play().catch(e => console.error("Play failed:", e));
        } else {
            audio.pause();
        }
    }

    function playTroubleAudio() {
        playAudioWithGain('troubleAudio', 9.0, true);
    }

    function playPhoneAudio() {
        playAudioWithGain('phoneAudio', 5.0, false);
    }
    
    /* Randomly spread numbers over the page without overlapping */
    document.addEventListener('DOMContentLoaded', function() {
        const numbers = document.querySelectorAll('.number');
        const placedPositions = [];
        const minDistance = 15; // Minimum distance in percentage to prevent overlap

        numbers.forEach(function(num) {
            let randomTop, randomLeft;
            let attempts = 0;
            let overlapping = true;

            // Try to find a non-overlapping position
            while (overlapping && attempts < 100) {
                randomTop = Math.floor(Math.random() * 80) + 10; // 10% to 90%
                randomLeft = Math.floor(Math.random() * 80) + 10; // 10% to 90%
                overlapping = false;

                for (let pos of placedPositions) {
                    const dx = pos.left - randomLeft;
                    const dy = pos.top - randomTop;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < minDistance) {
                        overlapping = true;
                        break;
                    }
                }
                attempts++;
            }
            
            // Store the position
            placedPositions.push({top: randomTop, left: randomLeft});

            // Random animation delay for more natural "fading" effect spread out
            const randomDelay = Math.random() * 5; // 0 to 5s delay
            
            num.style.top = randomTop + '%';
            num.style.left = randomLeft + '%';
            num.style.animationDelay = '-' + randomDelay + 's'; // Negative delay starts animation immediately at that point
        });
    });
</script>

<img src="images/Rufus3.png" class="rufus-popup" alt="Rufus">
<div class="message-bar">Just checking in!</div>

<audio id="swooshAudio" src="audio/swoosh.mp3" preload="auto"></audio>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const rufus = document.querySelector('.rufus-popup');
        const swoosh = document.getElementById('swooshAudio');
        
        function playSwoosh() {
            // Use shared helper with lower gain (0.4) to decrease volume
            playAudioWithGain('swooshAudio', 0.2, true);
        }

        if (rufus) {
            rufus.addEventListener('animationstart', playSwoosh);
            rufus.addEventListener('animationiteration', playSwoosh);
        }
    });
</script>

<audio id="ringAudio" src="audio/Ring.mp3" preload="auto"></audio>

<script>
    document.addEventListener('click', function (e) {
        // Don't play ring if clicking a button that plays other audio to avoid chaos? 
        // Or user wants it? The prompt said "None... are working".
        // Let's assume play it always as per original code.
        
        var ring = document.getElementById('ringAudio');
        if (!ring) return;
        
        // Simple play for ring, no gain needed?
        // If ring is too quiet, user might think it's broken. 
        // But original code had no gain.
        
        ring.currentTime = 0;
        ring.play().catch(function(error) {
            console.log("Ring play failed:", error);
        });
    });
</script>

</body>
</html>
